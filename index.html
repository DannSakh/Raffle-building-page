<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFXP SwitchOn Raffle</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        .file-upload {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-upload input[type="file"] {
            position: absolute;
            left: -9999px;
        }

        .file-upload label {
            background: #4299e1;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .file-upload label:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }

        .winner-select {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .winner-select select {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .spin-btn {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .spin-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .spin-btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }

        .reset-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .reset-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .reset-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .wheel-container {
            display: flex;
            justify-content: center;
            margin: 40px 0;
            position: relative;
        }

        .wheel {
            width: 500px;
            height: 500px;
            border-radius: 50%;
            border: 8px solid #2d3748;
            position: relative;
            transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .wheel-segment {
            position: absolute;
            width: 100%;
            height: 100%;
            clip-path: polygon(50% 50%, 50% 0%, 100% 0%);
            transform-origin: center;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 40px;
        }

        .segment-content {
            font-size: 13px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.9), 0 0 8px rgba(0, 0, 0, 0.5);
            text-align: center;
            line-height: 1.1;
            word-break: break-word;
            white-space: nowrap;
            overflow: visible;
        }

        .wheel-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #e53e3e;
            z-index: 10;
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            font-size: 0;
            line-height: 0;
        }

        .wheel-center img {
            width: 130px;
            height: 130px;
            object-fit: contain;
            display: block;
        }

        .participants-info {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
            border-left: 5px solid #4299e1;
        }

        .winners-info {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #fff5f5;
            border-radius: 10px;
            border-left: 5px solid #e74c3c;
        }

        .winners-display {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
        }

        .winners-display h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .winner-card {
            background: rgba(255, 255, 255, 0.95);
            color: #2d3748;
            padding: 20px;
            margin: 10px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.5s ease-out;
        }

        .winner-card h3 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 1.4em;
        }

        .winner-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .winner-detail {
            background: #f7fafc;
            padding: 10px;
            border-radius: 5px;
        }

        .winner-detail strong {
            color: #2d3748;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .spinning {
            animation: pulse 0.5s infinite;
        }

        .status-message {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: bold;
        }

        .status-success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .status-error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .wheel {
                width: 350px;
                height: 350px;
            }
            
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ NFXP SwitchOn Raffle</h1>
            <p>Upload participants and spin to win!</p>
        </div>

        <div class="controls">
            <div class="file-upload">
                <input type="file" id="fileInput" accept=".xlsx,.xls" />
                <label for="fileInput">üìÅ Upload Excel File</label>
            </div>

            <div class="winner-select">
                <label for="winnerCount">Winners per spin:</label>
                <select id="winnerCount">
                    <option value="1">1 Winner</option>
                    <option value="10">10 Winners</option>
                </select>
            </div>

            <button id="spinBtn" class="spin-btn" disabled>üé≤ Spin the Wheel!</button>
            
            <button id="resetBtn" class="reset-btn" disabled>üîÑ Reset All Winners</button>
        </div>

        <div id="statusMessage"></div>

        <div id="participantsInfo" class="participants-info" style="display: none;">
            <p><strong>Total Participants:</strong> <span id="participantCount">0</span></p>
        </div>

        <div id="winnersInfo" class="winners-info" style="display: none;">
            <p><strong>Winners so far:</strong> <span id="winnersSoFar">0</span> | <strong>Remaining participants:</strong> <span id="remainingCount">0</span></p>
        </div>

        <div class="wheel-container">
            <div class="wheel-pointer"></div>
            <div id="wheel" class="wheel">
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 18px; color: #666;">
                    Upload participants to start
                </div>
            </div>
            <div class="wheel-center">
                <img src="logo.png" alt="" onerror="this.style.display='none'">
            </div>
        </div>

        <div id="winnersDisplay" class="winners-display" style="display: none;">
            <h2>üéâ Winners! üéâ</h2>
            <div id="winnersContainer"></div>
        </div>
    </div>

    <script>
        let participants = [];
        let isSpinning = false;
        let usedParticipants = [];

        const fileInput = document.getElementById('fileInput');
        const spinBtn = document.getElementById('spinBtn');
        const resetBtn = document.getElementById('resetBtn');
        const wheel = document.getElementById('wheel');
        const participantsInfo = document.getElementById('participantsInfo');
        const participantCount = document.getElementById('participantCount');
        const winnersInfo = document.getElementById('winnersInfo');
        const winnersSoFar = document.getElementById('winnersSoFar');
        const remainingCount = document.getElementById('remainingCount');
        const winnersDisplay = document.getElementById('winnersDisplay');
        const winnersContainer = document.getElementById('winnersContainer');
        const winnerCountSelect = document.getElementById('winnerCount');
        const statusMessage = document.getElementById('statusMessage');

        function showStatus(message, type = 'success') {
            statusMessage.innerHTML = message;
            statusMessage.className = `status-message status-${type}`;
            statusMessage.style.display = 'block';
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }

        function updateWinnersInfo() {
            if (participants.length > 0) {
                winnersSoFar.textContent = usedParticipants.length;
                remainingCount.textContent = participants.length - usedParticipants.length;
                winnersInfo.style.display = 'block';
            }
        }

        fileInput.addEventListener('change', handleFileUpload);
        spinBtn.addEventListener('click', spinWheel);
        resetBtn.addEventListener('click', resetWinners);

        function resetWinners() {
            if (confirm('Are you sure you want to reset all winners?\n\nThis will:\n‚úì Clear all previous winners\n‚úì Allow everyone to participate again\n‚úì Start fresh raffle rounds')) {
                usedParticipants = [];
                winnersContainer.innerHTML = '';
                winnersDisplay.style.display = 'none';
                resetBtn.disabled = true;
                updateWinnersInfo();
                showStatus('‚úÖ All winners have been reset! Everyone can participate again.', 'success');
            }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                    if (jsonData.length === 0) {
                        showStatus('Excel file is empty.', 'error');
                        return;
                    }

                    participants = [];
                    usedParticipants = [];

                    // Read all rows as participant data (no headers)
                    for (let i = 0; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row && row.some(cell => cell !== undefined && cell !== '')) {
                            // Combine all non-empty cells into participant info
                            const participantInfo = row
                                .filter(cell => cell !== undefined && cell !== '')
                                .map(cell => cell.toString().trim())
                                .join(' | ');
                            
                            if (participantInfo) {
                                participants.push({
                                    displayText: participantInfo,
                                    rawData: row
                                });
                            }
                        }
                    }

                    if (participants.length === 0) {
                        showStatus('No valid participant data found in the Excel file.', 'error');
                        return;
                    }

                    updateParticipantsDisplay();
                    createWheel();
                    spinBtn.disabled = false;
                    resetBtn.disabled = true;
                    winnersContainer.innerHTML = '';
                    winnersDisplay.style.display = 'none';
                    updateWinnersInfo();
                    showStatus(`‚úÖ Successfully loaded ${participants.length} participants!`);

                } catch (error) {
                    console.error('Error reading file:', error);
                    showStatus('Error reading Excel file. Please check the file format.', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function updateParticipantsDisplay() {
            participantCount.textContent = participants.length;
            participantsInfo.style.display = 'block';
        }

        function createWheel() {
            const colors = [
                '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7',
                '#dda0dd', '#98d8c8', '#f7dc6f', '#bb8fce', '#85c1e9',
                '#ff8a80', '#82b1ff', '#b9f6ca', '#ffff8d', '#ff80ab',
                '#ea80fc', '#80d8ff', '#a7ffeb', '#ffd180', '#ff9e80'
            ];

            wheel.innerHTML = '';
            
            const numSegments = participants.length;
            const segmentAngle = 360 / numSegments;

            participants.forEach((participant, index) => {
                const segment = document.createElement('div');
                segment.className = 'wheel-segment';
                
                const rotation = index * segmentAngle;
                const nextRotation = (index + 1) * segmentAngle;
                
                // Calculate polygon points for pie slice
                const startAngle = rotation - 90;
                const endAngle = nextRotation - 90;
                
                const x1 = 50 + 50 * Math.cos(startAngle * Math.PI / 180);
                const y1 = 50 + 50 * Math.sin(startAngle * Math.PI / 180);
                const x2 = 50 + 50 * Math.cos(endAngle * Math.PI / 180);
                const y2 = 50 + 50 * Math.sin(endAngle * Math.PI / 180);
                
                segment.style.clipPath = `polygon(50% 50%, ${x1}% ${y1}%, ${x2}% ${y2}%)`;
                segment.style.backgroundColor = colors[index % colors.length];
                
                // Position text in the middle of the segment
                const content = document.createElement('div');
                content.className = 'segment-content';
                
                // Calculate position for text - further from center
                const middleAngle = (startAngle + endAngle) / 2;
                const textRotation = middleAngle + 90;
                const distance = 75; // Distance from center (%) - increased from 65
                
                const textX = 50 + distance * Math.cos(middleAngle * Math.PI / 180);
                const textY = 50 + distance * Math.sin(middleAngle * Math.PI / 180);
                
                content.style.position = 'absolute';
                content.style.left = textX + '%';
                content.style.top = textY + '%';
                content.style.transform = `translate(-50%, -50%) rotate(${textRotation}deg)`;
                content.style.width = 'auto';
                content.style.maxWidth = '120px';
                content.textContent = participant.displayText;
                
                segment.appendChild(content);
                wheel.appendChild(segment);
            });
        }

        function spinWheel() {
            if (isSpinning || participants.length === 0) return;
            
            const winnersCount = parseInt(winnerCountSelect.value);
            const availableParticipants = participants.filter(p => !usedParticipants.includes(p));
            
            if (availableParticipants.length === 0) {
                showStatus('‚ùå All participants have already won! Please click "Reset All Winners" to start new rounds.', 'error');
                return;
            }

            if (availableParticipants.length < winnersCount) {
                showStatus(`‚ö†Ô∏è Only ${availableParticipants.length} participants remaining. Please adjust winner count or reset.`, 'error');
                return;
            }

            isSpinning = true;
            spinBtn.disabled = true;
            wheel.classList.add('spinning');

            // More dramatic spinning
            const baseSpins = 8 + Math.floor(Math.random() * 4); // 8-11 full rotations
            const extraDegrees = Math.random() * 360;
            const totalRotation = (baseSpins * 360) + extraDegrees;
            
            // Get current rotation
            const currentRotation = parseFloat(wheel.style.transform.replace('rotate(', '').replace('deg)', '')) || 0;
            const finalRotation = currentRotation + totalRotation;
            
            wheel.style.transform = `rotate(${finalRotation}deg)`;

            setTimeout(() => {
                const winners = [];
                const shuffledAvailable = [...availableParticipants].sort(() => Math.random() - 0.5);
                
                for (let i = 0; i < winnersCount && i < shuffledAvailable.length; i++) {
                    winners.push(shuffledAvailable[i]);
                    usedParticipants.push(shuffledAvailable[i]);
                }

                displayWinners(winners);
                
                isSpinning = false;
                spinBtn.disabled = false;
                wheel.classList.remove('spinning');
                resetBtn.disabled = false;
                updateWinnersInfo();
                
                showStatus(`üéâ Congratulations to ${winners.length} winner${winners.length > 1 ? 's' : ''}!`);
            }, 5000);
        }

        function displayWinners(winners) {
            winnersContainer.innerHTML = '';
            
            winners.forEach((winner, index) => {
                const winnerCard = document.createElement('div');
                winnerCard.className = 'winner-card';
                winnerCard.style.animationDelay = `${index * 0.1}s`;
                
                winnerCard.innerHTML = `
                    <h3>üèÜ Winner ${winners.length > 1 ? index + 1 : ''}</h3>
                    <div class="winner-details">
                        <div class="winner-detail" style="grid-column: 1 / -1; font-size: 1.2em;">
                            ${winner.displayText}
                        </div>
                    </div>
                `;
                
                winnersContainer.appendChild(winnerCard);
            });
            
            winnersDisplay.style.display = 'block';
            winnersDisplay.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
